/*
 *
 * Wijmo Library 2.2.0
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";var j="wijmo-wijrating",h="wijmo-wijrating-starcontainer",c="wijmo-wijrating-reset",l="ui-corner-all",k="ui-state-default",i="ui-state-hover",g="wijmo-wijrating-resethover",m="wijmo-wijrating-star",b="wijmo-wijrating-normal",d="wijmo-wijrating-hover",e="wijmo-wijrating-rated",f="wijmo-wijrating-vertical";a.widget("wijmo.wijrating",{options:{disabled:false,count:5,split:1,totalValue:5,value:0,min:null,max:null,resetButton:{disabled:false,hint:"cancel this rating!",position:"leftOrTop",customizedClass:"",customizedHoverClass:""},hint:{disabled:false,content:null},orientation:"horizontal",direction:"normal",ratingMode:"continuous",icons:{iconsClass:null,hoverIconsClass:null,ratedIconsClass:null},iconWidth:16,iconHeight:16,animation:null,rating:null,rated:null,reset:null,hover:null},_setOption:function(g,e){var i=this,d=i.options,j=a("."+c,i.ratingElement[0]),k=a("."+h,i.ratingElement[0]),l=a("."+b,i.ratingElement[0]);if(a.isPlainObject(d[g])){switch(g){case"resetButton":if(typeof e.disabled!=="undefined")if(e.disabled!==d[g].disabled)if(e.disabled){j.hide();j.attr("aria-hidden",true)}else if(!d.disabled){j.show();j.attr("aria-hidden",false)}if(typeof e.hint!=="undefined")if(e.hint!==d[g].hint)if(e.hint===null)j.attr("title","");else j.attr("title",e.hint);if(e.position&&e.position.length)if(e.position!==d[g].position)if(e.position==="rightOrBottom")j.parent().append(j);else j.parent().prepend(j);if(typeof e.customizedClass!=="undefined")if(e.customizedClass!==d[g].customizedClass){d[g].customizedClass.length&&j.removeClass(d[g].customizedClass);e.customizedClass.length&&j.addClass(e.customizedClass)}break;case"hint":if(typeof e.disabled!=="undefined")if(e.disabled!==d[g].disabled)if(e.disabled)l.removeAttr("title");else i._resetHint(d.hint.content);if(typeof e.content!=="undefined")if(e.content!==d[g].content)!d[g].disabled&&i._resetHint(e.content);break;case"icons":if(typeof e.iconsClass!=="undefined"){d[g].iconsClass&&d[g].iconsClass.length&&i._removeCustomizedIconsClass(d[g].iconsClass);i._addCustomizedIconsClass(e.iconsClass,d.split)}if(typeof e.hoverIconsClass!=="undefined")d[g].hoverIconsClass&&d[g].hoverIconsClass.length&&i._removeCustomizedIconsClass(d[g].hoverIconsClass);if(typeof e.ratedIconsClass!=="undefined"){d[g].ratedIconsClass&&d[g].ratedIconsClass.length&&i._removeCustomizedIconsClass(d[g].ratedIconsClass);i._resetValue(d.value,d.ratingMode,e.ratedIconsClass)}}a.extend(true,d[g],e)}else{if(e===d[g])return;switch(g){case"disabled":if(e){i._unbindLiveEvents();j.hide();j.attr("aria-hidden",true)}else{i._bindLiveEvents();if(!d.resetButton.disabled){j.show();j.attr("aria-hidden",false)}}break;case"count":i._createStars(d.split,e,k);break;case"split":i._createStars(e,d.count,k);break;case"totalValue":i._resetTotalValue(e);break;case"orientation":if(e==="vertical")i.ratingElement.addClass(f);else i.ratingElement.removeClass(f);if(d.split>1){d[g]=e;i._createStars(d.split,d.count,k)}break;case"direction":d[g]=e;i._createStars(d.split,d.count,k);break;case"ratingMode":i._resetValue(d.value,e,d.icons.ratedIconsClass);break;case"value":if(d.min&&e<d.min)return;if(d.max&&e>d.max)return;i._resetValue(e,d.ratingMode,d.icons.ratedIconsClass);break;case"iconWidth":d[g]=e;i._createStars(d.split,d.count,k);break;case"iconHeight":d[g]=e;i._createStars(d.split,d.count,k)}a.Widget.prototype._setOption.apply(i,arguments)}},_create:function(){var b=this,d=b.options,c;if(window.wijmoApplyWijTouchUtilEvents)a=window.wijmoApplyWijTouchUtilEvents(a);if(b.element.is("select")){b._parseSelect();b.element.hide();c=a("<div></div>");b.element.after(c)}else if(b.element.is("div"))if(b.element.children("input[type='radio']").length>0){b._parseRadio();b.element.hide();c=a("<div></div>");b.element.after(c)}else c=b.element;else return;b.ratingElement=c;b._createRating();!d.disabled&&b._bindLiveEvents()},destroy:function(){var b=this;b._unbindLiveEvents();if(b.element!==b.ratingElement){b.ratingElement.remove();b.element.show()}else{b.element.removeClass("ui-widget");b.element.removeClass(j);b.element.removeClass(f);b.element.empty()}a.Widget.prototype.destroy.apply(b,arguments)},_unbindLiveEvents:function(){a("."+b,this.ratingElement[0]).die("wijrating").die(".wijrating");a("."+c,this.ratingElement[0]).die("wijrating").die(".wijrating")},_bindLiveEvents:function(){var f=this,e=f.options,j="."+b,m="."+c,h,l={element:f.ratingElement,mouseover:function(c){var b=a(c.target),g=a(j,f.ratingElement[0]);if(b.is(j)){g.removeClass(d);b.addClass(d);if(e.ratingMode==="continuous")if(e.direction==="reversed")b.parent().nextAll().children().addClass(d);else b.parent().prevAll().children().addClass(d);f._addCustomizedHoverIconsClass(e.icons.hoverIconsClass,e.split,b);h={value:parseFloat(b.html()),target:b};f._trigger("hover",c,h)}},mouseout:function(g){var c=a(g.target),b=a(j,f.ratingElement[0]);if(c.is(j)){b.removeClass(d);f._removeCustomizedIconsClass(e.icons.hoverIconsClass)}},click:function(c){var k=a(c.target),b=parseFloat(k.html()),g=a(j,f.ratingElement[0]),m=a.extend({duration:500,easing:null,delay:250},e.animation),l=a.wijmo.wijrating.animations,i=m.animated;if(!k.is(j))return;if(e.max&&b>e.max)return;if(e.min&&b<e.min)return;h={oldValue:e.value,newValue:b,target:k};if(f._trigger("rating",c,h)===false)return false;e.value=b;f._resetValue(b,e.ratingMode,e.icons.ratedIconsClass);g.removeClass(d);f._removeCustomizedIconsClass(e.icons.hoverIconsClass);h={value:b,target:k};if(i)if(l&&l[i])l[i](e,g,function(){f._trigger("rated",c,h)});else if(a.effects&&a.effects[i])f._playJqueryAnimation(m,g,function(){a.browser.msie&&a.browser.version<9&&g.css("filter","");f._trigger("rated",c,h)});else f._trigger("rated",c,h);else f._trigger("rated",c,h)}},k={element:f.ratingElement,mouseover:function(d){var b=a(d.target);b=b.closest("."+c);b.addClass(g);b.addClass(i);e.resetButton.customizedHoverClass&&e.resetButton.customizedHoverClass.length&&b.addClass(e.resetButton.customizedHoverClass)},mouseout:function(d){var b=a(d.target);b=b.closest("."+c);b.removeClass(g);b.removeClass(i);e.resetButton.customizedHoverClass&&e.resetButton.customizedHoverClass.length&&b.removeClass(e.resetButton.customizedHoverClass)},click:function(b){var c=a(b.target);f._setOption("value",0);h={target:c};f._trigger("reset",b,h)}};a(j,this.ratingElement[0]).live("mouseover.wijrating",a.proxy(l.mouseover,l)).live("mouseout.wijrating",a.proxy(l.mouseout,l)).live("click.wijrating",a.proxy(l.click,l));a(m,this.ratingElement[0]).live("mouseover.wijrating",a.proxy(k.mouseover,k)).live("mouseout.wijrating",a.proxy(k.mouseout,k)).live("click.wijrating",a.proxy(k.click,k))},_clearIntentTimer:function(){var b=this;b.intentTimers&&b.intentTimers.length&&a.each(b.intentTimers,function(b,a){if(a){window.clearTimeout(a);a=null}});b.intentTimers=[]},_playJqueryAnimation:function(b,c,e){var d=this,h=d.options,f={easing:b.easing},g=b.animated;d._clearIntentTimer();c.each(function(j,l){var k=Math.floor(j/h.split)*b.delay,i;i=window.setTimeout(function(){a(l).hide(g,f,b.duration,function(){if(j!==c.length-1)return;c.each(function(j,l){var k=Math.floor(j/h.split)*b.delay,i;i=window.setTimeout(function(){a(l).show(g,f,b.duration,function(){if(j===c.length-1)e&&a.isFunction(e)&&e.call(this)})},k);d.intentTimers.push(i)})})},k);d.intentTimers.push(i)})},_addCustomizedIconsClass:function(c,h){var g=this,f,e=0,d=0;if(c&&c.length){f=a("."+b,g.ratingElement[0]);f.each(function(i,b){if(e===h){e=0;d++}if(typeof c==="string")a(b).addClass(c);else if(a.isArray(c)){var f=c.length;if(d<f)if(g.options.direction==="reversed")a(b).addClass(c[f-d-1]);else a(b).addClass(c[d])}e++})}},_addCustomizedHoverIconsClass:function(c,j,g){var l=this,m=l.options,i=m.direction,k=m.ratingMode,f=a("."+b,l.ratingElement[0]),h=f.index(g),e=0,d;if(c&&c.length)if(typeof c==="string"){g.addClass(c);if(k!=="single")if(i==="reversed")g.parent().nextAll().children().addClass(c);else g.parent().prevAll().children().addClass(c)}else if(a.isArray(c))if(k==="single"){if(i==="reversed")d=f.length-1-h;else d=h;e=Math.floor(d/j);c.length>e&&g.addClass(c[e])}else if(i==="reversed")for(d=f.length-1;d>=h;d--){e=Math.floor((f.length-1-d)/j);c.length>e&&a(f[d]).addClass(c[e])}else for(d=0;d<=h;d++){e=Math.floor(d/j);c.length>e&&a(f[d]).addClass(c[e])}},_removeCustomizedIconsClass:function(c){var e=this,d=a("."+b,e.ratingElement[0]);if(c&&c.length)if(typeof c==="string")d.removeClass(c);else a.isArray(c)&&a.each(c,function(b,a){d.removeClass(a)})},_resetValue:function(j,l,c){var k=this,g=k.options,i=a("."+b,k.ratingElement[0]),m=l||g.ratingMode,h=c&&c.length,f=0,d;i.each(function(k,n){var b=a(n),l=parseFloat(b.html());b.removeClass(e);b.parent().attr("aria-checked",false);if(h)if(typeof c==="string"){b.removeClass(c);d=c}else if(a.isArray(c)){a.each(c,function(c,a){b.removeClass(a)});if(g.direction==="reversed")f=Math.floor((i.length-1-k)/g.split);else f=Math.floor(k/g.split);if(c.length>f)d=c[f]}if(l===j){b.addClass(e);h&&b.addClass(d);b.parent().attr("aria-checked",true)}else if(m==="continuous")if(l<j){b.addClass(e);h&&b.addClass(d)}})},_resetTotalValue:function(l){var j=this,g=j.options,d=g.hint,i=a("."+b,j.ratingElement[0]),h=i.length,e,k,f,c=0;for(c;c<h;c++){f=Math.round((c+1)*l*100/h)/100;e=a(i[c]);k=parseFloat(e.html());if(k===g.value)g.value=f;e.html(f);if(d&&d.length&&d.length>=c&&d[c]&&d[c].length)e.attr("title",d[c]);else e.attr("title",f)}},_resetHint:function(d){var h=this,f=a("."+b,h.ratingElement[0]),e,g,c=0;for(c;c<f.length;c++){e=a(f[c]);g=parseFloat(e.html());if(d&&d.length&&d.length>=c&&d[c]&&d[c].length)e.attr("title",d[c]);else e.attr("title",g)}},_createRating:function(){var m=this,g=m.ratingElement,d=m.options,b,i,e;g.addClass(j+" ui-widget");d.orientation==="vertical"&&g.addClass(f);b=a("<div></div>");b.addClass(c);b.addClass(l);b.addClass(k);d.resetButton.customizedClass&&d.resetButton.customizedClass.length&&b.addClass(d.resetButton.customizedClass);b.appendTo(g);b.attr("role","button");b.attr("aria-label","reset");b.attr("aria-hidden",false);d.resetButton.hint&&d.resetButton.hint.length&&b.attr("title",d.resetButton.hint);if(d.resetButton.disabled||d.disabled){b.hide();b.attr("aria-hidden",true)}i=a("<span></span>");i.addClass("ui-icon ui-icon-close");b.append(i);e=a("<div></div>");e.attr("role","radiogroup");e.addClass(h);if(d.resetButton.position==="leftOrTop")e.appendTo(g);else e.prependTo(g);m._createStars(d.split,d.count,e)},_createStars:function(g,t,q){var u=this,c=u.options,k=c.hint,d,f,l,i=0,h=0,s=Math.ceil(c.iconWidth/g),r=Math.ceil(c.iconHeight/g),j=c.icons.ratedIconsClass,o,n,p=j&&j.length;q.empty();for(i;i<t*g;i++,h++){l=Math.round((i+1)*c.totalValue*100/t/g)/100;if(h===g)h=0;f=a("<div></div>");f.attr("role","radio");f.attr("aria-checked",false);if(c.orientation==="vertical"){f.width(c.iconWidth);f.height(r)}else{f.width(s);f.height(c.iconHeight)}f.addClass(m);d=a("<div>"+l+"</div>");d.addClass(b);d.width(c.iconWidth);d.height(c.iconHeight);f.attr("aria-label",l);if(h>0&&c.direction==="normal")if(c.orientation==="vertical")d.css({"margin-top":"-"+h*r+"px"});else d.css({"margin-left":"-"+h*s+"px"});else if(h<g-1&&c.direction==="reversed")if(c.orientation==="vertical")d.css({"margin-top":"-"+(g-1-h)*r+"px"});else d.css({"margin-left":"-"+(g-1-h)*s+"px"});if(!k.disabled)if(k.content&&k.content.length){if(i<=k.content.length){d.attr("title",k.content[i]);f.attr("aria-label",k.content[i])}}else d.attr("title",l);if(p)if(typeof j==="string")n=j;else if(a.isArray(j)){o=Math.floor(i/g);if(j.length>o)n=j[o]}if(l===c.value){d.addClass(e);p&&d.addClass(n);f.attr("aria-checked",true)}else if(l<c.value&&c.ratingMode==="continuous"){d.addClass(e);p&&d.addClass(n)}d.appendTo(f);if(c.direction==="reversed")f.prependTo(q);else f.appendTo(q)}u._addCustomizedIconsClass(c.icons.iconsClass,g)},_parseRadio:function(){var e=this,d=e.options,b=[],c=a("input[type='radio']",e.element);if(c.length){d.count=c.length;d.totalValue=c.length;c.each(function(i,h){var g=a(h),c=g.attr("id"),f;if(c&&c.length>0){f=a("label[for='"+c+"']",e.element);if(f.length)b.push(f.html());else b.push("")}else b.push("");if(g.is(":checked"))d.value=i+1});d.hint.content=b}},_parseSelect:function(){var e=this,c=e.options,d=[],b=a("option",e.element);if(b.length){c.count=b.length;c.totalValue=b.length;b.each(function(e,f){var b=a(f);d.push(b.html());if(b.is(":selected"))c.value=e+1});c.hint.content=d}}});a.extend(a.wijmo.wijrating,{animations:{scroll:function(i,c,b){var e=i,d=b,g=250,j=500,f=250,h=jQuery.makeArray(c);h.reverse();a.each(h,function(i,m){var l=Math.floor(i/e.split)*f,k={width:0},b,h;b=window.setTimeout(function(){a(m).animate(k,g,function(){window.clearTimeout(b);if(i!==c.length-1)return;h=window.setTimeout(function(){c.each(function(h,k){var j=Math.floor(h/e.split)*f,i={width:e.iconWidth},b;b=window.setTimeout(function(){a(k).animate(i,g,function(){window.clearTimeout(b);if(h===c.length-1)d&&a.isFunction(d)&&d.call(this)})},j)});window.clearTimeout(h)},j)})},l)});b&&a.isFunction(b)&&b.call(this)}}})})(jQuery);