/*
 *
 * Wijmo Library 1.5.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijinputnumber",a.extend(true,{},wijinputcore,{options:{type:"numeric",value:null,minValue:-1e9,maxValue:1e9,showGroup:false,decimalPlaces:2,increment:1,valueChanged:null,valueBoundsExceeded:null},_createTextProvider:function(){this._textProvider=new c(this,this.options.type)},_beginUpdate:function(){var a=this.options;this.element.addClass("wijmo-wijinput-numeric");this.element.data({defaultValue:a.value,preValue:a.value}).attr({"aria-valuemin":a.minValue,"aria-valuemax":a.maxValue,"aria-valuenow":a.value||0})},_onTriggerClicked:function(){this._popupComboList()},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments);wijinputcore._setOption.apply(this,arguments);switch(c){case"minValue":this.element.attr("aria-valuemin",b);this._updateText();break;case"maxValue":this.element.attr("aria-valuemax",b);this._updateText();break;case"value":this.setValue(b);this._updateText();break;case"showGroup":case"decimalPlaces":case"culture":this._textProvider.updateStringFormat();this._updateText()}},_setData:function(a){this.setValue(a)},_resetData:function(){var a=this.element.data("defaultValue");if(a===undefined||a===null){a=this.element.data("elementValue");if(a===undefined||a===null&&a==="")a=0}this.setValue(a)},_validateData:function(){this._textProvider.checkAndRepairBounds(true,false)&&this._updateText()},_raiseDataChanged:function(){var a=this.options.value,b=this.element.data("preValue");this.element.data("preValue",a);if(b!==a){this.element.attr("aria-valuenow",a);this._trigger("valueChanged",null,{value:a})}},getValue:function(){var a=this._textProvider.getValue();if(a===undefined||a===null)a=this.getText();return a},setValue:function(a,b){try{b=!!b;if(typeof a==="boolean")a=a?"1":"0";else if(typeof a==="string")a=this._textProvider.tryParseValue(a);if(this._textProvider.setValue(a))this._updateText();else if(b){var c="";c=this.getText();this.setText(a);a=a.trim();var d=this.getText().trim();d!==a&&this.setText(c)}else this.setText(a);return true}catch(e){return false}},isValueNull:function(){try{return this._textProvider.isValueNull()}catch(a){return true}},_updateText:function(){if(!this._isInitialized())return;this.options.value=this._textProvider.getValue();wijinputcore._updateText.apply(this,arguments);!this._textProvider.checkAndRepairBounds(false,false)&&this._trigger("valueBoundsExceeded")},_doSpin:function(e,c){e=!!e;c=!!c;if(!this._allowEdit())return;if(c&&this.element.data("breakSpinner"))return;var d=this.element.wijtextselection(),b=new wijInputResult;if(this.element.data("focusNotCalledFirstTime")!==-9&&+new Date-this.element.data("focusNotCalledFirstTime")<600){this.element.data("focusNotCalledFirstTime",-9);this.element.data("prevCursorPos",0)}if(this.element.data("prevCursorPos")===-1)this.element.data("prevCursorPos",d.start);else d.start=this.element.data("prevCursorPos");b.testPosition=d.start;this._textProvider[e?"incEnumPart":"decEnumPart"](d.start,b,this.options.increment);this._updateText();this.element.data("prevCursorPos",b.testPosition);this.selectText(b.testPosition,b.testPosition);c&&!this.element.data("breakSpinner")&&window.setTimeout(a.proxy(function(){this._doSpin(e,true)},this),this._calcSpinInterval())}}));var c=function(a,c){this.inputWidget=a;this._type=c;this._stringFormat=new b(this._type,this.inputWidget.options.decimalPlaces,this.inputWidget.options.showGroup,this._getCulture());this._stringFormat._setValueFromJSFloat(this.getValue())};c.prototype={_type:"numeric",_stringFormat:null,_getCulture:function(){return this.inputWidget._getCulture()},getDecimalSeparator:function(){return this._getCulture().numberFormat["."]},tryParseValue:function(a){return this._stringFormat.tryParseValue(a)},toString:function(){return this.inputWidget.options.showNullText&&!this.inputWidget.isFocused()&&this.isValueNull()?this.inputWidget.options.nullText:this._stringFormat.getFormattedValue()},isValueNull:function(){var a=this.inputWidget.options,b=Math.max(0,a.minValue);return null===a.value||undefined===a.value||b===a.value},"set":function(a,b){this.clear();this.insertAt(a,0,b);return true},clear:function(){this._stringFormat.clear()},checkAndRepairBounds:function(a,c){var b=true;if(typeof a==="undefined")a=false;var d=this.inputWidget.options.minValue,e=this.inputWidget.options.maxValue;if(typeof c!=="undefined"&&c)return this._stringFormat.checkMinValue(d,false,true);if(!this._stringFormat.checkMinValue(d,a,false))b=false;if(!this._stringFormat.checkMaxValue(e,a))b=false;this.inputWidget.options.decimalPlaces>=0&&this._stringFormat.checkDigitsLimits(this.inputWidget.options.decimalPlaces);return b},countSubstring:function(c,b){var d=0,a=c.indexOf(b);while(a!==-1){d++;a=c.indexOf(b,a+1)}return d},getAdjustedPositionFromLeft:function(b){for(var e=this._stringFormat._currentText,c=0;c<e.length;c++){var d=e.charAt(c);if(!a.wij.charValidator.isDigit(d)&&d!==","&&d!=="."||d==="0"){if(this._stringFormat.isZero()){if(b<c)b++}else if(b<=c)b++}else break}return b},getDecimalSeparatorPos:function(){var a=this._stringFormat._currentText;return a.indexOf(this.getDecimalSeparator())},insertAt:function(b,d,c){var h=this._getCulture().numberFormat;if(b===h["."])b=h["."];if(!c)c=new wijInputResult;if(b.length===1){if(b==="+"){this._stringFormat.setPositiveSign();this.checkAndRepairBounds(true,false);return true}if(b==="-"||b===")"||b==="("){this._stringFormat.invertSign();this.checkAndRepairBounds(true,false);c.testPosition=d;if(this._stringFormat.isNegative())c.testPosition=d;else c.testPosition=d-2;return true}if(!a.wij.charValidator.isDigit(b)){if(b==="."){var j=this.getDecimalSeparatorPos();if(j>=0){c.testPosition=j;return true}}if(b!==","&&b!=="."&&b!==")"&&b!=="+"&&b!=="-"&&b!=="("&&b!==this.getDecimalSeparator())if(this._type==="percent"&&b===h.percent.symbol){c.testPosition=d;return true}else if(this._type==="currency"&&b===h.currency.symbol){c.testPosition=d;return true}else return false}}d=this.getAdjustedPositionFromLeft(d);var g=d,e=this._stringFormat._currentText;if(g>e.length)g=e.length-1;if(b.length===1)if(e.charAt(g)===b){c.testPosition=g;return true}var f=e.substring(0,g),i=e.substring(g,e.length);if(this._stringFormat.isZero())i=i.replace(new RegExp("[0]"),"");c.testPosition=f.length+b.length-1;this._stringFormat.deFormatValue(f+b+i);this.checkAndRepairBounds(true,false);try{if(b.length===1)if(this.inputWidget.options.showGroup){var l=this._stringFormat._currentText.substring(0,f.length);if(this.countSubstring(l,this._stringFormat._groupSeparator)!==this.countSubstring(f,this._stringFormat._groupSeparator))c.testPosition=c.testPosition+1}else{var k=f.charAt(f.length-1),m=this._stringFormat._currentText.charAt(c.testPosition-1);if(m!==k)c.testPosition=c.testPosition-1}}catch(n){}return true},removeAt:function(b,e,a){var f=this._getCulture().numberFormat;if(!a)a=new wijInputResult;a.testPosition=b;try{var c=this._stringFormat._currentText;if(b===e&&c.substring(b,e+1)===this.getDecimalSeparator())return false;var d=c.slice(0,b)+c.slice(e+1);if(d==="")d="0";this._stringFormat.deFormatValue(d);if(b===e&&this.inputWidget.options.showGroup)try{var g=this._stringFormat._currentText.substring(0,b);if(this.countSubstring(g,this._stringFormat._groupSeparator)!==this.countSubstring(d,this._stringFormat._groupSeparator)){a.testPosition=a.testPosition-1;if(c.indexOf(f.currency.symbol)===a.testPosition||c.indexOf(f.percent.symbol)===a.testPosition)a.testPosition=a.testPosition+1}}catch(h){}this.checkAndRepairBounds(true,false);return true}catch(i){}this.checkAndRepairBounds(true,false);return true},incEnumPart:function(c,a,b){if(!a)a=new wijInputResult;this._stringFormat.increment(b);return this.checkAndRepairBounds(true,false)},decEnumPart:function(c,a,b){if(!a)a=new wijInputResult;this._stringFormat.decrement(b);return this.checkAndRepairBounds(true,false)},getValue:function(){return this._stringFormat.getJSFloatValue()},setValue:function(a){try{this._stringFormat._setValueFromJSFloat(a);this.checkAndRepairBounds(true,false);return true}catch(b){return false}},updateStringFormat:function(){var a="0";if(typeof this._stringFormat!=="undefined")a=this._stringFormat._currentValueInString;this._stringFormat=new b(this._type,this.inputWidget.options.decimalPlaces,this.inputWidget.options.showGroup,this._getCulture());this._stringFormat._currentValueInString=a}};var b=function(d,a,c,b){this.type=d;this.digitsPlaces=a;this.showGroup=c;this.culture=b};b.prototype={_currentValueInString:"0",_currentText:"0",_groupSeparator:" ",type:"numeric",digitsPlaces:0,showGroup:false,culture:null,isNegtive:function(a){return a.indexOf("-")!==-1||a.indexOf("(")!==-1},stripValue:function(a){var b=this.culture.numberFormat,g=this.isNegtive(a);a=a.replace("(","");a=a.replace(")","");a=a.replace("-","");a=a.replace(b.percent.symbol,"");a=a.replace(b.currency.symbol,"");var d=b[","],e=b["."];switch(this.type){case"percent":d=b.percent[","];e=b.percent["."];break;case"currency":d=b.currency[","];e=b.currency["."]}this._groupSeparator=d;var c=new RegExp("["+d+"]","g");a=a.replace(c,"");c=new RegExp("["+e+"]","g");a=a.replace(c,".");c=new RegExp("[ ]","g");a=a.replace(c,"");try{var h=new RegExp("([\\d\\.])+"),f=h.exec(a);if(f)a=f[0];if(g)a="-"+a;return a}catch(i){}return null},tryParseValue:function(a){a=this.stripValue(a);if(a===null)return 0;try{a=parseFloat(a);if(isNaN(a))a=0}catch(b){a=0}return a},deFormatValue:function(a){a=this.stripValue(a);if(a===null)return;this._currentValueInString=a;this._currentText=this.formatValue(a)},formatValue:function(c){var a=this.culture.numberFormat;c=""+c+"";var j=this.digitsPlaces,g=" ",e=".",f=2,i=this.isNegtive(c),d=new Array(3);d.push(3);var h="n";switch(this.type){case"numeric":h=i?a.pattern[0]:"n";g=a[","];e=a["."];f=a.decimals;d=a.groupSizes;break;case"percent":h=a.percent.pattern[i?0:1];g=a.percent[","];e=a.percent["."];f=a.percent.decimals;d=a.percent.groupSizes;break;case"currency":h=a.currency.pattern[i?0:1];g=a.currency[","];e=a.currency["."];f=a.currency.decimals;d=a.currency.groupSizes}if(j!==-2)f=j;if(!this.showGroup)d=[0];c=c.replace(new RegExp("^[0]+"),"");var b=this.formatDigit(c,g,e,f,d);b=b.replace(new RegExp("^[0]+"),"");if(b.indexOf(e)===0)b="0"+b;if(b==="")b="0";this._currentValueInString=c;this._currentText=this.applyFormatPattern(h,b,a.percent.symbol,a.currency.symbol);return this._currentText},getFormattedValue:function(){return this.formatValue(this._currentValueInString)},getJSFloatValue:function(){try{return this._currentValueInString===""?0:parseFloat(this._currentValueInString)}catch(a){return Number.NaN}},clear:function(){this._currentValueInString="0";this._currentText="0"},_setValueFromJSFloat:function(a){try{this._currentValueInString=""+a+"";this.formatValue(a);return true}catch(b){return false}},isZero:function(b){try{if(b===undefined)b=this._currentValueInString;var a=b.replace("-","");a=a.replace("(","");a=a.replace(")","");if(!a.length)a="0";var c=parseFloat(a);if(!isNaN(c)&&!c)return true}catch(d){}return false},setPositiveSign:function(){this._currentValueInString=this._currentValueInString.replace("-","");this._currentValueInString=this._currentValueInString.replace("(","");this._currentValueInString=this._currentValueInString.replace(")","")},isNegative:function(){return this._currentValueInString.indexOf("-")!==-1||this._currentValueInString.indexOf("(")!==-1},invertSign:function(){var a=this.isNegative();if(a)this.setPositiveSign();else this._currentValueInString=!this._currentValueInString.length?"0":"-"+this._currentValueInString;if(this.isZero())this._currentValueInString=a?"0":"-0";this.formatValue(this._currentValueInString)},increment:function(b){if(b===undefined)b=1;try{var a=this._currentValueInString.split(".");this._currentValueInString=a[0]*1+b+""+(a.length>1?"."+a[1]:"")}catch(c){}},decrement:function(b){if(b===undefined)b=1;try{var a=this._currentValueInString.split(".");this._currentValueInString=a[0]*1-b+""+(a.length>1?"."+a[1]:"")}catch(c){}},checkDigitsLimits:function(f){try{var a=this._currentValueInString.split(".");if(!a.length||a.length===1&&a[0]==="")return;var d="";if(a.length>1)d=a[1];for(var b="",c=0;c<f;c++){var e="0";if(d.length>c)e=d.charAt(c);b=b+e}if(b.length>0)this._currentValueInString=a[0]+"."+b;else this._currentValueInString=a[0]}catch(g){}},checkMinValue:function(g,i,h){if(typeof h==="undefined")h=false;var d=true;try{var a=this._currentValueInString.split("."),b=parseFloat(a[0]===""||a[0]==="-"?"0":a[0]),c=0;if(a.length>1&&parseFloat(a[1])>0)c=parseFloat("1."+a[1]);if(b<0||a[0]==="-")c=c*-1;g=""+g+"";a=g.split(".");var e=parseFloat(a[0]),f=0;if(a.length>1&&parseFloat(a[1])>0)f=parseFloat("1."+a[1]);if(b>e)return true;if(b<e||h&&b===e&&c<=f)d=false;else if(b===e&&b<0&&c>f)d=false;else if(b===e&&b>=0&&c<f)d=false;if(!d&&i)this._currentValueInString=""+g+""}catch(j){}return d},checkMaxValue:function(f,h){var c=true;try{var a=this._currentValueInString.split("."),b=parseFloat(a[0]===""||a[0]==="-"?"0":a[0]),d=0;if(a.length>1&&parseFloat(a[1])>0)d=parseFloat("1."+a[1]);if(b<0||a[0]==="-")d=d*-1;f=""+f+"";a=f.split(".");var e=parseFloat(a[0]),g=0;if(a.length>1&&parseFloat(a[1])>0)g=parseFloat("1."+a[1]);if(b<e)return true;if(b>e)c=false;if(b===e&&b>=0&&d>g)c=false;if(b===e&&b<0&&d<g)c=false;if(!c&&h)this._currentValueInString=""+f+""}catch(i){}return c},applyFormatPattern:function(f,e,d,c){var a=f,b=new RegExp("[n]","g");a=a.replace(b,e);b=new RegExp("[%]","g");a=a.replace(b,d);b=new RegExp("[$]","g");a=a.replace(b,c);return a},formatDigit:function(l,k,g,j,i){var a=""+l+"";a=a.replace("-","");a=a.replace("(","");a=a.replace(")","");var c=a.indexOf(g);if(c===-1)c=a.indexOf(".");if(c===-1)c=a.indexOf(",");if(c===-1)c=a.length;for(var b="",f=0,h=0,e,d=a.length-1;d>=0;d--){e=a.charAt(d);if(d<c){b=e+b;h++;if(h===i[f]*1&&i[f]*1&&d){b=k+b;h=0;if(i.length-1>f)f++}}}if(j>0){b=b+g;for(d=0;d<j;d++){e="0";if(d+c+1<a.length)e=a.charAt(d+c+1);b=b+e}}if(j===-1)if(c<a.length-1){b=b+g;b=b+a.substr(c+1)}return b}}})(jQuery);