/*
 *
 * Wijmo Library 2.1.2
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";var c=180,b=9,d=5;a.widget("wijmo.wijradialgauge",a.wijmo.wijgauge,{options:{radius:"auto",startAngle:0,sweepAngle:180,pointer:{length:.8,style:{fill:"#1E395B",stroke:"#1E395B"},width:8,offset:.15},origin:{x:.5,y:.5},labels:{style:{fill:"#1E395B","font-size":12,"font-weight":"800"},offset:30},tickMinor:{position:"inside",offset:30,style:{fill:"#1E395B"},visible:true},tickMajor:{position:"inside",offset:27,style:{fill:"#1E395B",stroke:"#1E395B","stroke-width":1},visible:true},cap:{radius:15,style:{fill:"#1E395B",stroke:"#1E395B"},behindPointer:false,visible:true,template:null},face:{style:{fill:"r(0.9, 0.60)#FFFFFF-#D9E3F0",stroke:"#7BA0CC","stroke-width":4}}},_create:function(){var b=this;a.wijmo.wijgauge.prototype._create.apply(b,arguments);b.element.addClass("wijmo-wijradialgauge")},_init:function(){var b=this;a.wijmo.wijgauge.prototype._init.apply(b,arguments)},_set_radius:function(){var a=this;a._redrawMarksAndLabels();a.pointer.remove();a._paintPointer();a._setPointer()},_set_startAngle:function(){var a=this;a._redrawMarksAndLabels();a._setPointer()},_set_sweepAngle:function(b){var a=this;if(b>360)a.options.endAngle=360;a._redrawMarksAndLabels();a._setPointer()},_set_width:function(){var b=this;b._autoCalculate();a.wijmo.wijgauge.prototype._set_width.apply(b,arguments)},_set_height:function(){var b=this;b._autoCalculate();a.wijmo.wijgauge.prototype._set_width.apply(b,arguments)},_set_origin:function(){var b=this;b._autoCalculate();a.wijmo.wijgauge.prototype._set_width.apply(b,arguments)},_set_cap:function(){var a=this;a.pointer.remove();a._paintPointer();a._setPointer()},_valueToAngleIncludeOffset:function(b){return a.wijgauge.math.mod360(this._valueToAngle(b)+c)},_valueToAngle:function(c){var a=this,b=a._valueToLogical(c);return a._logicalToAngle(b)},_angleToValue:function(c){var a=this,b=a._angleToLogical(c);return a._logicalToValue(b)},_logicalToAngle:function(b){var e=this,c=e.options,a=c.startAngle,d=c.sweepAngle;return a*(1-b)+(a+d)*b},_angleToLogical:function(h){var i=this,f=i.options,g=f.startAngle,c=a.wijgauge.math.mod360(h-g),b=f.sweepAngle,d,e;if(b===0||c===0)return 0;if(b<0){c=360-c;b=-b}d=c-b;if(d>0){e=360-c;return d<e?1:0}return c/b},_generatePoints:function(a,g,f,n){for(var l=this,m=parseInt(b+b*(Math.abs(parseInt(g-a,10))/(b*d)),10),i=[],c,h,k,j,e=0;e<m;e++){c=e/(m-1);h=f+(n-f)*c;j=a+(g-a)*c;k=l._angleToValue(j);i.push(l._valueToPoint(k,h))}return i},_valueToPoint:function(d,c){var e=this,b=e._valueToAngleIncludeOffset(d)*Math.PI/180,a=c;return{x:a*Math.cos(b),y:a*Math.sin(b)}},_pointToValue:function(b){var c=a.wijgauge.math.mod360(Math.atan2(b.x,-b.y)*180/Math.PI);return this._angleToValue(c)},_radiusScreen:function(a){var b=this,c=b.options;return Math.max(c.radius*a,0)},_autoCalculate:function(){var c=this,b=c.options,m=b.width,l=b.height,e,f,g,k=a.wijgauge.formatString(b.max,b.labels.format),d=0,i,h=l-b.marginTop-b.marginBottom,j=m-b.marginLeft-b.marginRight;c.centerPoint={x:b.marginLeft+j*b.origin.x,y:b.marginTop+h*b.origin.y};c.radius=b.radius;if(b.radius==="auto"){c.faceRadius=Math.min(j,h)/2;i=c._getFaceBorder();c.faceRadius-=i;if(b.tickMajor.position==="inside")c.faceRadius-=c._getMaxRangeWidth();e=c._getMarkerbbox(b.tickMajor).width;f=c._getMarkerbbox(b.tickMinor).width;g=c._getLabelBBox(k).width;if(b.tickMajor.position==="center"){d-=e/2;d-=g}else if(b.tickMajor.position==="outside"){d-=e;d-=g}if(b.tickMinor.position==="center")d=Math.min(d,-f/2);else if(b.tickMinor.position==="outside")d=Math.min(d,-f);c.radius=c.faceRadius+d}},_getMaxRangeWidth:function(){var c=this,d=c.options,b=0;a.each(d.ranges,function(c,a){b=Math.max(b,a.width||0);b=Math.max(b,a.startWidth||0);b=Math.max(b,a.endWidth||0)});return b},_getMarkerbbox:function(d){var c=this,b=c._paintMarkEle(d),a=b.wijGetBBox();b.remove();return{width:a.width,height:a.height}},_getFaceBorder:function(){var c=this,a=c._paintFace(),b=a.attr("stroke-width")||1;if(a.type==="set")b=a[0].attr("stroke-width")||1;a.remove();return b},_paintMarks:function(){var b=this;b.markBbox=null;a.wijmo.wijgauge.prototype._paintMarks.apply(b,arguments)},_paintMark:function(e,c){var d=this,b,f=c.position||"inside",g=c.offset||0;b=d._paintMarkEle(c);b.attr(c.style);a.wijraphael.addClass(a(b.node),"wijmo-wijradialgauge-mark");a(b.node).data("value",e);d._applyAlignment(b,f,g);d._setMarkValue(e,b);return b},_applyAlignment:function(b,e,d){if(!b)return;var f=b.wijGetBBox(),c=f.width/2,a=0;switch(e){case"outside":a-=c+d;break;case"inside":a+=c+d}b.transform("t"+a+",0")},_paintMarkEle:function(f){var b=this,i=b.options,d={x:b.centerPoint.x-b.radius,y:b.centerPoint.y},c=f.marker||"circle",g=c==="rect"?5:2,h=2,e;e=g*f.factor;return a.isFunction(c)?c.call(b,b.canvas,d,i):a.wijgauge.paintMarker(b.canvas,c,d.x,d.y,e,h)},_setMarkValue:function(c,d){var a=this,b=a._valueToAngle(c);d.transform(Raphael.format("r{0},{1},{2}...",b,a.centerPoint.x,a.centerPoint.y))},_paintLabel:function(i,g){var b=this,o=b._valueToAngle(i),k=g.format,p=g.style,n=g.offset,j=i,l=b.options.tickMajor,m=l.position||"inside",h,f,d,c,e;if(k!=="")j=a.wijgauge.formatString(i,k);d=b._getMarkerBbox();e=b._getLabelBBox(j);switch(m){case"inside":c=d.x+d.width+e.width/2;break;case"outside":c=d.x-e.width/2;break;default:c=d.x-e.width/2}c=b.centerPoint.x-c+n;h=a.wijmo.wijradialgauge.utility.getPositionByAngle(b.centerPoint.x,b.centerPoint.y,c,o);f=b.canvas.text(h.x,h.y,j);f.attr(p);a.wijraphael.addClass(a(f.node),"wijmo-wijradialgauge-label");return f},_getLabelBBox:function(d){var c=this,e=c.options,a,b;a=c.canvas.text(0,0,d);a.attr(e.gaugeLableStyle);b=a.wijGetBBox();a.remove();return b},_getMarkerBbox:function(){var a=this,d=a.options,c=d.tickMajor,b;if(!a.markBbox){b=a._paintMarkEle(c,true);a._applyAlignment(b,c.position,c.offset||0);a.markBbox=b.wijGetBBox();b.remove()}return a.markBbox},_paintFace:function(){var b=this,c=b.options,e=Math.min(c.width,c.height)/2,d,f;if(b.faceRadius)e=b.faceRadius;if(c.face&&c.face.template&&a.isFunction(c.face.template)){f={canvas:b.canvas,r:e,origin:{x:b.centerPoint.x,y:b.centerPoint.y}};return c.face.template.call(b,f)}d=b.canvas.circle(b.centerPoint.x,b.centerPoint.y,e);c.face&&c.face.style&&d.attr(c.face.style);a.wijraphael.addClass(a(d.node),"wijmo-wijradialgauge-face");return d},_paintPointer:function(){var c=this,d=c.options,b=d.pointer,g=c.radius*b.length,f={x:c.centerPoint.x-g+b.offset*c.radius,y:c.centerPoint.y-b.width/2},e;if(!b.visible)return;d.cap&&d.cap.behindPointer&&d.cap.visible&&c._paintCap();if(b.template&&a.isFunction(b.template))e=b.template.call(c.canvas,f,a.extend({},b,{length:g}));else{if(b.shape==="rect")e=c.canvas.rect(f.x-b.width/2,f.y,g,b.width);else e=c.canvas.isoTri(f.x-b.width/2,f.y,g,b.width);e.attr(b.style)}c.pointer=e;a.wijraphael.addClass(a(e.node),"wijmo-wijradialgauge-pointer");(!d.cap||!d.cap.behindPointer)&&d.cap.visible&&c._paintCap()},_paintCap:function(){var b=this,e=b.options,c=e.cap,d;if(c&&c.template&&a.isFunction(c.template)){d={canvas:b.canvas,origin:{x:b.centerPoint.x,y:b.centerPoint.y}};b.cap=c.template.call(b,d);return b.cap}b.cap=b.canvas.circle(b.centerPoint.x,b.centerPoint.y,c.radius);c&&c.style&&b.cap.attr(c.style);a.wijraphael.addClass(a(b.cap.node),"wijmo-wijradialgauge-cap");return b.cap},_paintRange:function(a){var d=this,e=d.options,b=isNaN(a.startValue)?0:a.startValue,c=isNaN(a.endValue)?0:a.endValue,j=isNaN(a.startWidth)?isNaN(a.width)?0:a.width:a.startWidth,k=isNaN(a.endWidth)?isNaN(a.width)?0:a.width:a.endWidth,f=a.startDistance||1,h=a.endDistance||1,g,i;if(b!==c){if(c>b){g=Math.max(b,e.min);i=Math.min(e.max,c)}else{g=Math.max(e.min,c);i=Math.min(e.max,b)}f=f*d.radius;h=h*d.radius;d._drawRange(g,i,f,h,j,k,a)}},_drawRange:function(o,p,g,h,l,m,n){var b=this,i=b._valueToAngle(o),j=b._valueToAngle(p),k=b._generatePoints(i,j,l+g,m+h),f=b._generatePoints(i,j,g,h),d,e,c="";a.each(k,function(d,a){if(d===0)c+="M"+(a.x+b.centerPoint.x)+" "+(a.y+b.centerPoint.y);else c+="L"+(a.x+b.centerPoint.x)+" "+(a.y+b.centerPoint.y)});for(d=f.length-1;d>=0;d--)c+="L"+(f[d].x+b.centerPoint.x)+" "+(f[d].y+b.centerPoint.y);c+="Z";e=b.canvas.path(c);e.attr(n.style);b.ranges.push(e);a.wijraphael.addClass(a(e.node),"wijmo-wijradialgauge-range")},_setOffPointerValue:function(){var a=this,b=a._valueToAngle(0);a.pointer.transform(Raphael.format("r{0},{1},{2}",b,a.centerPoint.x,a.centerPoint.y))},_setPointer:function(){var b=this,e=b.options,d=b._valueToAngle(e.value),c=e.animation;if(!b.pointer)return;a.wijmo.wijgauge.prototype._setPointer.apply(this,arguments);if(c.enabled)b.pointer.stop().wijAnimate({transform:"r"+d+","+b.centerPoint.x+","+b.centerPoint.y},c.duration,c.easing);else b.pointer.transform(Raphael.format("r{0},{1},{2}",d,b.centerPoint.x,b.centerPoint.y))}});a.wijmo.wijradialgauge.utility={pointers:{donut:function(k,c,d,b,h,f,g){var e=a.wijmo.wijradialgauge.utility.getPositionByAngle,i=e(c,d,b,f),n=e(c,d,b,g),m=e(c,d,h,f),l=e(c,d,h,g),j=g-f>180,o;if((g-f)%360!==0){o=["M",i.x,i.y,"A",b,b,0,+j,1,n.x,n.y,"L",l.x,l.y,"A",h,h,0,+j,1,m.x,m.y,"L",i.x,i.y,"z"];k.path(o)}else k.circle(c,d,b)}},getPositionByAngle:function(e,f,c,d){var a={},b=Raphael.rad(d);a.x=e-c*Math.cos(b);a.y=f-c*Math.sin(b);return a}}})(jQuery);